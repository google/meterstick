This folder contains the data analysis scripts for the paper
"A Grammar of Data Analysis".

In the "datasets" folder, you will find the raw data used in the paper.

- The "baseball_pitches_to_SEA_batters.csv" file contains all pitches thrown
  to the batters in the 2019 opening day starting lineup of the Seattle Mariners
  from 2015-18. The data was extracted from this
  [Kaggle data set](https://www.kaggle.com/datasets/pschale/mlb-pitch-data-20152018).
  This file only contains player IDs, so the results can be joined to
  "baseball_player_names.csv" for readability.

- The "minimum_wage.csv" file contains the minimum wage data used in the
  paper. It's taken from the https://davidcard.berkeley.edu/data_sets.html
  with modification that
  1. The column names are added.
  2. The missing data are represented as "NA", instead of ".", so it can be
     easily parsed by pandas.
  3. The delimiter is changed to ";".

- The "churn_rate.csv" file contains the churn rate data used in the paper. It's generated by the following python script.

```
import pandas as pd
import numpy as np

np.random.seed(42)
n = 1000
churn_rates = {'control': 0.2, 'treatment1': 0.1, 'treatment2': 0.25, 'treatment3': 0.3}
df = pd.DataFrame({
    'region': np.random.choice(('US', 'EU'), n),
    'experiment': np.random.choice(list(churn_rates), n),
})
# Make churn rates at the US 0.03 higher to those at EU.
df['lost'] = np.random.random(n) < (
    df.experiment.replace(churn_rates) + 0.03 * (df.region == 'US')
)
df.to_csv(sep=';', index=False)
```

In the script, we simulate user churning, where for region 'EU', the churn
rate is 0.2 for the control group, 0.1 for the "treatment1" group, 0.25 for
the "treatment2" group, and 0.3 for the "treatment3" group; and for region 'US',
the churn rates are 0.03 higher than those for region 'EU'. The simulation is
done by drawing from the uniform distribution between 0 and 1.

The `Meterstick_example_implementations.ipynb` implements the `Metric`s and
`Operations` mentioned in the paper, including `Sum`, `Count`, `PercentChange`
and `Bootstrap`.

The `Meterstick_minimum_wage.ipynb` replicates the minimum wage study.

The `Meterstick_churn_rate.ipynb` analyzes user churn rate on a simulated data.
